<%

const autoincrement_keyword = framework.configuraciones.instancia.valores.BASE_DE_DATOS_TIPO === 'local' ? "AUTOINCREMENT" : "AUTO_INCREMENT";

%>

/* Inicio de nueva query */

CREATE TABLE Usuario_no_confirmado (
  id INTEGER PRIMARY KEY <%=autoincrement_keyword%>,
  nombre VARCHAR(255) NOT NULL UNIQUE,
  contrasenya VARCHAR(255),
  correo VARCHAR(255) NOT NULL UNIQUE,
  otros VARCHAR(512),
  token_de_confirmacion VARCHAR(100),
  detalles TEXT
);

/* Inicio de nueva query */

CREATE TABLE Usuario (
  id INTEGER PRIMARY KEY <%=autoincrement_keyword%>,
  nombre VARCHAR(255),
  contrasenya VARCHAR(255),
  correo VARCHAR(255),
  otros VARCHAR(512),
  detalles TEXT
);

/* Inicio de nueva query */

CREATE TABLE Grupo (
  id INTEGER PRIMARY KEY <%=autoincrement_keyword%>,
  nombre VARCHAR(255),
  detalles TEXT
);

/* Inicio de nueva query */

CREATE TABLE Permiso (
  id INTEGER PRIMARY KEY <%=autoincrement_keyword%>,
  nombre VARCHAR(255),
  detalles TEXT
);

/* Inicio de nueva query */

CREATE TABLE Grupos_de_usuario (
  id INTEGER PRIMARY KEY <%=autoincrement_keyword%>,
  id_grupo INT,
  id_usuario INT,
  FOREIGN KEY (id_usuario) REFERENCES Usuario (id),
  FOREIGN KEY (id_grupo) REFERENCES Grupo (id)
);

/* Inicio de nueva query */

CREATE TABLE Permisos_de_grupo (
  id INTEGER PRIMARY KEY <%=autoincrement_keyword%>,
  id_permiso INT,
  id_grupo INT,
  FOREIGN KEY (id_permiso) REFERENCES Permiso (id),
  FOREIGN KEY (id_grupo) REFERENCES Grupo (id)
);

/* Inicio de nueva query */

CREATE TABLE Permisos_de_usuario (
  id INTEGER PRIMARY KEY <%=autoincrement_keyword%>,
  id_permiso INT,
  id_usuario INT,
  FOREIGN KEY (id_usuario) REFERENCES Usuario (id),
  FOREIGN KEY (id_permiso) REFERENCES Permiso (id)
);